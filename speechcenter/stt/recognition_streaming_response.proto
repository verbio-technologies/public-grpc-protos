syntax = "proto3";

package speechcenter.recognizer.v1;

message RecognitionStreamingResponse {
    oneof recognition_response {
        // If set, returns the error that prevented the operation.
        RecognitionError error = 1;

        // A recognition result for the audio currently being processed.
        RecognitionResult result = 2;

        // If set, indicates that a specific speech event occurred.
        SpeechEvent speech_event = 4;
    }
    // An MRCP standard completion cause code.
    uint32 completion_cause = 3;
}

// A streaming recognition result for a specific portion of the audio.
message RecognitionResult {
    // A list of one or more recognition hypotheses, ordered by accuracy.
    repeated RecognitionAlternative alternatives = 1;

    // The duration of the recognized audio segment.
    float duration = 2;

    // If true, this is the final result for this audio segment. 
    // If false, it is an interim result that may change.
    bool is_final = 3;

    // The start time of the audio segment, relative to the beginning of the stream.
    float start_time = 4;
   
    // If true, this result marks the end of an utterance (endpoint).
    bool is_endpoint = 5;
}

// Hypothesis-specific information.
message RecognitionAlternative {
    // Transcript text representing the words spoken by the user.
    string transcript = 1;

    // A confidence estimate between 0.0 and 1.0.
    float confidence = 2;

    // A list of word-specific details for each recognized word.
    repeated WordInfo words = 3;
}

// Word-specific information for recognized words.
message WordInfo {
    // The start time of the word in seconds, relative to the beginning of the audio.
    float start_time = 1;

    // The end time of the word in seconds, relative to the beginning of the audio.
    float end_time = 2;

    // The spoken word.
    string word = 3;

    // A confidence estimate between 0.0 and 1.0.
    float confidence = 4;

    // A unique number identifying the speaker.
    uint32 speaker_id = 5;
}

message SpeechEvent {
    enum Event {
        // Indicates that the start of speech was detected in the audio stream.
        SPEECH_START = 0;
    }

    // The type of speech event.
    Event type = 1;

    // The time offset in seconds, relative to the beginning of the audio, where the event was detected.
    float time_offset = 2;
}

message RecognitionError {
    // The reason for the error. This is a constant value that identifies the
    // proximate cause.
    string reason = 1;

    // The logical grouping to which the "reason" belongs. The error domain
    // is typically the registered service name of the tool or product that
    // generated the error.
    string domain = 2;

    // Additional structured details about this error, usually formatted as JSON.
    map<string, string> metadata = 3;
}